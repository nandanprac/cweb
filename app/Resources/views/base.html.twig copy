<!DOCTYPE html>
<html>
<head lang="en">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>{% block title %}Consult Web{% endblock %}</title>

    {#{% stylesheets '@jquery_bootstrap_css' '@CwiPageBundle/Resources/public/css/*' %}#}
    {% stylesheets '@CwiPageBundle/Resources/public/css/*' %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

{% block navigation %}
    {% include 'CwiPageBundle::header.html.twig' %}
{% endblock %}

<!-- Page Content -->
<div class="container">
    <div class="row">

        <!-- Main Content -->
        {% block body %}
        {% endblock %}


        <!-- Extra Column Space -->
        <div class="col-lg-3 col-md-3">&nbsp;</div>

        <!-- Sidebar -->
        <div class="col-lg-7 col-md-7 paddingrightzero">
            <!-- Blog Search Well -->
            <div class="well paddingrightzero col-lg-offset-1 hidden-sm hidden-xs">
                {% block sidebar %}
                    {{ render(controller('CwiPageBundle:Widget:sidebar')) }}
                {% endblock %}
            </div>
        </div>

    </div>

    <hr>

    {% block footer %}
        {% include 'CwiPageBundle::footer.html.twig' %}
    {% endblock %}

</div>

{% javascripts '@jquery_bootstrap_js' %}
<script src="{{ absolute_url(asset_url) }}"></script>
{% endjavascripts %}

<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>

<script type="text/javascript">
    is_processing = false;
    var page = 1;
    last_page = false;
    function addMoreElements() {
        is_processing = true;
        $.ajax({
            type: "GET",
            //FOS Routing
            url: Routing.generate('cwi_page_feed', {page: page}),
            success: function(data) {
                console.log(data);
                $('#feeds').append(data);
                page+=1;
                is_processing = false;
            },
            error: function(data) {
                is_processing = false;
            }
        });
    }

    $(window).scroll(function() {
        var wintop = $(window).scrollTop(), docheight = $(document).height(), winheight = $(window).height();
        //Modify this parameter to establish how far down do you want to make the ajax call
        var scrolltrigger = 0.80;
        if ((wintop / (docheight - winheight)) > scrolltrigger) {
            //I added the is_processing variable to keep the ajax asynchronous but avoiding making the same call multiple times
            if (last_page === false && is_processing === false) {
                addMoreElements();
            }
        }
    });
</script>

</body>
</html>